
## 第13课：描述统计与参数估计

### 统计学背景
描述统计是统计学的基础，帮助我们总结和描述数据的基本特征。参数估计则是统计推断的核心，通过样本数据估计总体参数。在生态学研究中，我们通常只能观察到总体的一部分（样本），需要通过样本来推断总体的特征，如某物种的平均体重、种群密度的置信区间等。

### 演示数据
```r
# 某保护区植物群落调查数据
set.seed(123)
plant_height <- rnorm(50, mean = 120, sd = 25)      # 植物高度(cm)
species_count <- rpois(40, lambda = 15)             # 样方物种数
cover_percentage <- rbeta(35, 2, 3) * 100           # 植被覆盖度(%)
survival_rate <- rbinom(60, 1, 0.85)                # 植物存活情况
```

### 课堂演示过程

#### 1. 描述统计基础

##### 中心趋势测量
```r
# 创建植物高度数据
set.seed(123)
plant_heights <- rnorm(50, mean = 120, sd = 25)

# 1. 算术平均数（均值）
mean_height <- mean(plant_heights)
print(paste("平均高度:", round(mean_height, 2), "cm"))

# 2. 中位数
median_height <- median(plant_heights)
print(paste("中位数高度:", round(median_height, 2), "cm"))

# 3. 众数（自定义函数）
calculate_mode <- function(x) {
  # 对于连续数据，找最频繁出现的近似值
  density_result <- density(x)
  mode_value <- density_result$x[which.max(density_result$y)]
  return(mode_value)
}
mode_height <- calculate_mode(plant_heights)
print(paste("近似众数:", round(mode_height, 2), "cm"))

# 比较三种中心趋势测量
print("=== 中心趋势比较 ===")
print(paste("均值:", round(mean_height, 2)))
print(paste("中位数:", round(median_height, 2)))
print(paste("众数:", round(mode_height, 2)))
```

##### 离散程度测量
```r
# 1. 极差
range_height <- max(plant_heights) - min(plant_heights)
print(paste("极差:", round(range_height, 2), "cm"))

# 2. 四分位距
q1 <- quantile(plant_heights, 0.25)
q3 <- quantile(plant_heights, 0.75)
iqr_height <- q3 - q1
print(paste("四分位距:", round(iqr_height, 2), "cm"))

# 3. 方差
var_height <- var(plant_heights)
print(paste("方差:", round(var_height, 2), "cm²"))

# 4. 标准差
sd_height <- sd(plant_heights)
print(paste("标准差:", round(sd_height, 2), "cm"))

# 5. 变异系数
cv_height <- sd_height / mean_height * 100
print(paste("变异系数:", round(cv_height, 2), "%"))

# 五数概括
summary_stats <- summary(plant_heights)
print("五数概括:")
print(summary_stats)
```

##### 分布形状与矩测量
```r
# 安装并加载moments包（如果没有的话）
# install.packages("moments")
library(moments)

# 1. 偏度（Skewness）
skewness_value <- skewness(plant_heights)
print(paste("偏度:", round(skewness_value, 3)))

# 解释偏度
if (abs(skewness_value) < 0.5) {
  skew_interpretation <- "近似对称"
} else if (abs(skewness_value) < 1) {
  skew_interpretation <- "中等偏度"
} else {
  skew_interpretation <- "高度偏斜"
}

if (skewness_value > 0) {
  direction <- "右偏（正偏）"
} else if (skewness_value < 0) {
  direction <- "左偏（负偏）"
} else {
  direction <- "对称"
}
print(paste("分布形状:", skew_interpretation, "-", direction))

# 2. 峰度（Kurtosis）
kurtosis_value <- kurtosis(plant_heights)
excess_kurtosis <- kurtosis_value - 3  # 超额峰度
print(paste("峰度:", round(kurtosis_value, 3)))
print(paste("超额峰度:", round(excess_kurtosis, 3)))

# 解释峰度（与正态分布比较）
if (excess_kurtosis > 0.5) {
  kurt_interpretation <- "尖峰分布（比正态分布更尖）"
} else if (excess_kurtosis < -0.5) {
  kurt_interpretation <- "平峰分布（比正态分布更平）"
} else {
  kurt_interpretation <- "近似正态分布峰度"
}
print(paste("峰度特征:", kurt_interpretation))

# 3. 分位数分析
print("=== 分位数分析 ===")
quantiles <- quantile(plant_heights, probs = c(0.1, 0.25, 0.5, 0.75, 0.9))
print("重要分位数:")
print(round(quantiles, 2))

# 四分位距和异常值检测
iqr_value <- IQR(plant_heights)
lower_bound <- quantiles["25%"] - 1.5 * iqr_value
upper_bound <- quantiles["75%"] + 1.5 * iqr_value

outliers <- plant_heights[plant_heights < lower_bound | plant_heights > upper_bound]
print(paste("异常值数量:", length(outliers)))
print(paste("异常值范围:", if(length(outliers)>0) paste(round(range(outliers),2), collapse="-") else "无"))

# 4. 中心矩计算（手动）
print("=== 中心矩计算 ===")
mean_val <- mean(plant_heights)
central_moments <- numeric(4)

for (i in 1:4) {
  central_moments[i] <- mean((plant_heights - mean_val)^i)
}

print(paste("一阶中心矩（均值）:", round(central_moments[1], 3)))
print(paste("二阶中心矩（方差）:", round(central_moments[2], 3)))
print(paste("三阶中心矩（偏度分子）:", round(central_moments[3], 3)))
print(paste("四阶中心矩（峰度分子）:", round(central_moments[4], 3)))

# 验证偏度和峰度公式
manual_skewness <- central_moments[3] / (sqrt(central_moments[2])^3)
manual_kurtosis <- central_moments[4] / (central_moments[2]^2)

print(paste("手动计算偏度:", round(manual_skewness, 3)))
print(paste("手动计算峰度:", round(manual_kurtosis, 3)))
```

#### 2. 样本与总体的关系

```r
# 演示抽样分布的概念
set.seed(456)

# 假设总体：某森林所有树木的高度服从N(150, 30²)
population_mean <- 150
population_sd <- 30

# 从总体中抽取不同大小的样本
sample_sizes <- c(5, 10, 30, 100)
n_simulations <- 1000

# 存储不同样本大小的样本均值
sampling_distribution <- list()

for (i in 1:length(sample_sizes)) {
  n <- sample_sizes[i]
  sample_means <- numeric(n_simulations)
  
  for (j in 1:n_simulations) {
    sample_data <- rnorm(n, mean = population_mean, sd = population_sd)
    sample_means[j] <- mean(sample_data)
  }
  
  sampling_distribution[[i]] <- sample_means
  
  print(paste("样本大小:", n))
  print(paste("样本均值的均值:", round(mean(sample_means), 2)))
  print(paste("样本均值的标准差:", round(sd(sample_means), 2)))
  print(paste("理论标准误:", round(population_sd/sqrt(n), 2)))
  print("---")
}

# 可视化抽样分布
par(mfrow = c(2, 2))
for (i in 1:length(sample_sizes)) {
  hist(sampling_distribution[[i]], 
       main = paste("n =", sample_sizes[i]), 
       xlab = "样本均值",
       col = "lightblue",
       breaks = 30)
  abline(v = population_mean, col = "red", lwd = 2)
}
par(mfrow = c(1, 1))
```

#### 3. 点估计

```r
# 点估计：用样本统计量估计总体参数

# 生成一个样本
set.seed(789)
sample_data <- rnorm(30, mean = 120, sd = 20)

# 1. 均值的点估计
sample_mean <- mean(sample_data)
print(paste("样本均值（总体均值的点估计）:", round(sample_mean, 2)))

# 2. 方差的点估计
sample_var <- var(sample_data)  # 无偏估计（分母为n-1）
print(paste("样本方差（总体方差的点估计）:", round(sample_var, 2)))

# 3. 标准差的点估计
sample_sd <- sd(sample_data)
print(paste("样本标准差（总体标准差的点估计）:", round(sample_sd, 2)))

# 4. 比例的点估计（对于二分类数据）
# 例子：植物存活情况
survival_data <- rbinom(50, 1, 0.8)
survival_proportion <- mean(survival_data)
print(paste("存活比例的点估计:", round(survival_proportion, 3)))

# 点估计的性质
# 1. 无偏性演示
true_mean <- 100
n_samples <- 1000
sample_means <- numeric(n_samples)

for (i in 1:n_samples) {
  sample_i <- rnorm(20, mean = true_mean, sd = 15)
  sample_means[i] <- mean(sample_i)
}

bias <- mean(sample_means) - true_mean
print(paste("估计偏差:", round(bias, 4)))
print("样本均值是总体均值的无偏估计")
```

#### 3.1 种群大小估计方法

```r
# 种群生态学中的参数估计方法

##### 标记重捕法（Mark-Recapture）
# Lincoln-Petersen估计量
M <- 100    # 首次标记个体数
C <- 150    # 第二次捕获个体数  
R <- 25     # 重捕标记个体数

# 种群大小估计
N_estimate <- (M * C) / R
print(paste("Lincoln-Petersen种群大小估计:", round(N_estimate)))

# 标准误计算
se_N <- sqrt((M^2 * C * (C - R)) / (R^3))
print(paste("估计标准误:", round(se_N, 2)))

# 95%置信区间
ci_lower <- N_estimate - 1.96 * se_N
ci_upper <- N_estimate + 1.96 * se_N
print(paste("95%置信区间: [", round(ci_lower), ", ", round(ci_upper), "]"))

##### 去除法（Removal Method）
# 连续捕获去除数据
captures <- c(50, 35, 25, 18, 12)  # 连续捕获次数

# 最大似然估计（简单线性回归方法）
total_removed <- cumsum(captures)
remaining <- sum(captures) - total_removed[1:4]

# 线性回归估计捕获概率和种群大小
lm_model <- lm(remaining ~ total_removed[1:4])
capture_prob <- -coef(lm_model)[2]  # 捕获概率
N_remove <- coef(lm_model)[1] / capture_prob  # 种群大小估计

print(paste("去除法估计 - 捕获概率:", round(capture_prob, 3)))
print(paste("去除法估计 - 种群大小:", round(N_remove)))

##### 距离抽样法（Distance Sampling）
# 需要安装Distance包
# install.packages("Distance")
library(Distance)

# 模拟距离数据（实际应用中从野外调查获取）
distance_data <- data.frame(
  distance = c(2.1, 5.3, 8.7, 3.2, 6.8, 4.5, 9.1, 1.8, 7.2, 5.9,
               3.8, 6.1, 4.2, 8.3, 2.9, 7.8, 5.1, 9.5, 3.5, 6.4),
  detected = rep(1, 20)
)

# 简单密度估计（实际应用需要更复杂的模型）
# 这里仅演示概念
mean_detection_distance <- mean(distance_data$distance)
density_estimate <- nrow(distance_data) / (pi * mean_detection_distance^2)
print(paste("距离抽样密度估计:", round(density_estimate, 3), "个体/单位面积"))
```

#### 4. 区间估计（置信区间）

```r
# 置信区间：给出参数的可能取值范围

# 1. 均值的置信区间（已知总体方差或大样本）
set.seed(321)
sample_heights <- rnorm(50, mean = 150, sd = 25)

n <- length(sample_heights)
sample_mean <- mean(sample_heights)
sample_sd <- sd(sample_heights)

# 95%置信区间
confidence_level <- 0.95
alpha <- 1 - confidence_level
z_score <- qnorm(1 - alpha/2)  # 双侧检验

# 标准误
standard_error <- sample_sd / sqrt(n)

# 置信区间
margin_error <- z_score * standard_error
ci_lower <- sample_mean - margin_error
ci_upper <- sample_mean + margin_error

print(paste("样本均值:", round(sample_mean, 2)))
print(paste("95%置信区间: [", round(ci_lower, 2), ", ", round(ci_upper, 2), "]"))

# 解释置信区间
print("解释：我们有95%的信心认为总体均值在此区间内")

# 2. t分布置信区间（小样本，总体方差未知）
small_sample <- sample_heights[1:15]  # 小样本
n_small <- length(small_sample)
mean_small <- mean(small_sample)
sd_small <- sd(small_sample)

# t分布临界值
t_critical <- qt(1 - alpha/2, df = n_small - 1)
se_small <- sd_small / sqrt(n_small)
margin_t <- t_critical * se_small

ci_t_lower <- mean_small - margin_t
ci_t_upper <- mean_small + margin_t

print("=== 小样本t分布置信区间 ===")
print(paste("样本大小:", n_small))
print(paste("95%置信区间: [", round(ci_t_lower, 2), ", ", round(ci_t_upper, 2), "]"))

# 3. 比例的置信区间
# 例子：种子萌发率
germinated <- 42  # 萌发的种子数
total_seeds <- 50  # 总种子数
p_hat <- germinated / total_seeds

# 正态近似（大样本）
se_p <- sqrt(p_hat * (1 - p_hat) / total_seeds)
margin_p <- z_score * se_p
ci_p_lower <- p_hat - margin_p
ci_p_upper <- p_hat + margin_p

print("=== 比例的置信区间 ===")
print(paste("样本比例:", round(p_hat, 3)))
print(paste("95%置信区间: [", round(ci_p_lower, 3), ", ", round(ci_p_upper, 3), "]"))

# 4. 不同置信水平的比较
confidence_levels <- c(0.90, 0.95, 0.99)
print("=== 不同置信水平的置信区间 ===")

for (conf_level in confidence_levels) {
  alpha_i <- 1 - conf_level
  z_i <- qnorm(1 - alpha_i/2)
  margin_i <- z_i * standard_error
  ci_lower_i <- sample_mean - margin_i
  ci_upper_i <- sample_mean + margin_i
  
  print(paste(conf_level*100, "%置信区间: [", 
              round(ci_lower_i, 2), ", ", round(ci_upper_i, 2), "]"))
}
```

#### 5. 估计精度与样本大小

```r
# 样本大小对估计精度的影响

# 1. 给定精度要求，计算所需样本大小
desired_margin <- 5      # 期望的误差边界
population_sd_est <- 25  # 总体标准差的估计
confidence_level <- 0.95
z_score <- qnorm(1 - (1-confidence_level)/2)

required_n <- (z_score * population_sd_est / desired_margin)^2
print(paste("要求误差边界不超过", desired_margin, 
            "cm，需要样本大小：", ceiling(required_n)))

# 2. 不同样本大小的置信区间宽度比较
sample_sizes <- c(10, 20, 50, 100, 200)
ci_widths <- numeric(length(sample_sizes))

for (i in 1:length(sample_sizes)) {
  n <- sample_sizes[i]
  se <- population_sd_est / sqrt(n)
  margin <- z_score * se
  ci_widths[i] <- 2 * margin  # 置信区间宽度
}

# 可视化置信区间宽度与样本大小的关系
plot(sample_sizes, ci_widths, 
     type = "b", 
     main = "置信区间宽度 vs 样本大小",
     xlab = "样本大小", 
     ylab = "95%置信区间宽度",
     col = "blue",
     pch = 19)
grid()

print("=== 样本大小与置信区间宽度 ===")
for (i in 1:length(sample_sizes)) {
  print(paste("n =", sample_sizes[i], 
              ", 置信区间宽度:", round(ci_widths[i], 2)))
}
```

#### 6. 生物多样性参数估计

```r
# 物种多样性估计方法

##### 物种丰富度外推（Rarefaction）
# 安装并加载vegan包
# install.packages("vegan")
library(vegan)

# 模拟群落数据（不同样本量的物种数）
set.seed(123)
community_matrix <- matrix(rpois(100, lambda = c(rep(15, 5), rep(3, 15))), 
                          nrow = 10, ncol = 20)
colnames(community_matrix) <- paste("Sp", 1:20)

# Rarefaction曲线
rare_curve <- rarefy(community_matrix, sample = seq(10, 100, by = 10))
print("Rarefaction曲线（期望物种数）:")
print(rare_curve)

# 绘制Rarefaction曲线
plot(seq(10, 100, by = 10), rare_curve, 
     type = "b", 
     main = "Rarefaction曲线",
     xlab = "个体数", 
     ylab = "期望物种数",
     col = "blue", pch = 19)
grid()

##### 非参数丰富度估计量
# Chao1估计量（基于稀有物种）
chao1_estimate <- estimateR(community_matrix)[2, ]  # Chao1估计
print("Chao1丰富度估计:")
print(chao1_estimate)

# ACE估计量（丰度覆盖估计）
ace_estimate <- estimateR(community_matrix)[4, ]  # ACE估计
print("ACE丰富度估计:")
print(ace_estimate)

# 观察物种数与估计物种数比较
observed_species <- apply(community_matrix > 0, 1, sum)
print("观察物种数与估计值比较:")
comparison <- data.frame(
  观察物种数 = observed_species,
  Chao1估计 = chao1_estimate[1:10],
  ACE估计 = ace_estimate[1:10]
)
print(comparison)

##### 多样性指数的区间估计
# Shannon多样性指数的置信区间（自助法）
shannon_diversity <- diversity(community_matrix, index = "shannon")

# 自助法计算标准误
n_boot <- 1000
boot_samples <- numeric(n_boot)

for (i in 1:n_boot) {
  # 重抽样
  boot_data <- community_matrix[sample(nrow(community_matrix), replace = TRUE), ]
  boot_samples[i] <- diversity(boot_data, index = "shannon")[1]
}

shannon_se <- sd(boot_samples)
shannon_ci <- quantile(boot_samples, c(0.025, 0.975))

print(paste("Shannon多样性:", round(mean(shannon_diversity), 3)))
print(paste("自助法标准误:", round(shannon_se, 3)))
print(paste("95%置信区间: [", 
            round(shannon_ci[1], 3), ", ", 
            round(shannon_ci[2], 3), "]"))

##### 样本量对多样性估计的影响
# 不同样本量下的多样性估计
sample_sizes <- c(5, 10, 15, 20, 25)
diversity_estimates <- matrix(NA, nrow = length(sample_sizes), ncol = 3)
colnames(diversity_estimates) <- c("Shannon", "Simpson", "Species_Richness")

for (i in 1:length(sample_sizes)) {
  subsample <- community_matrix[1:sample_sizes[i], ]
  diversity_estimates[i, 1] <- mean(diversity(subsample, index = "shannon"))
  diversity_estimates[i, 2] <- mean(diversity(subsample, index = "simpson"))
  diversity_estimates[i, 3] <- mean(apply(subsample > 0, 1, sum))
}

print("不同样本量下的多样性估计:")
print(diversity_estimates)
```

### R语言知识点详解

#### 1. 描述统计函数系统

##### 中心趋势测量
- **`mean(x, na.rm = FALSE)`**：算术平均数
  - 适用于数值型数据
  - `na.rm = TRUE`可忽略缺失值
  - 受极值影响较大

- **`median(x, na.rm = FALSE)`**：中位数
  - 对极值稳健
  - 适用于偏态分布
  - 50%分位数

- **`mode()`**：R没有内置mode函数，需自定义
  - 对于离散数据：最频繁出现的值
  - 对于连续数据：使用密度估计

##### 离散程度测量
- **`var(x, na.rm = FALSE)`**：样本方差
  - 分母为n-1（无偏估计）
  - 单位为原变量单位的平方

- **`sd(x, na.rm = FALSE)`**：样本标准差
  - 方差的平方根
  - 与原变量同单位
  - **定义**：衡量单个观测值相对于均值的离散程度
  - **公式**：$s = \sqrt{\frac{1}{n-1}\sum_{i=1}^n (x_i - \bar{x})^2}$

- **标准误（Standard Error）**
  - **定义**：衡量样本统计量（如样本均值）抽样分布的离散程度
  - **公式**：$SE = \frac{s}{\sqrt{n}}$
  - **与标准差的关系**：
    - 标准差描述单个观测值的变异程度
    - 标准误描述样本均值的变异程度（估计精度）
    - 标准误 = 标准差 / √样本大小
  - **生态学意义**：标准误越小，样本均值对总体均值的估计越精确

- **变异系数（Coefficient of Variation, CV）**
  - **定义**：标准差与均值的比值，表示相对变异程度
  - **公式**：$CV = \frac{s}{\bar{x}} \times 100\%$
  - **生态学应用**：
    - **种内性状差异**：评估表型可塑性和遗传变异程度
    - **种群时间稳定性**：CV值越小表示种群数量越稳定
    - **环境梯度响应**：分析性状变异沿环境梯度的变化模式
    - **物种比较**：消除量纲影响，比较不同物种的变异程度
  - **R实现**：`cv <- sd(x) / mean(x) * 100`

- **`range(x, na.rm = FALSE)`**：值域
  - 返回c(min, max)
  - 计算极差：`diff(range(x))`

- **`quantile(x, probs)`**：分位数
  - `probs`：要计算的分位数（0-1之间）
  - 常用：`quantile(x, c(0.25, 0.5, 0.75))`

- **`IQR(x, na.rm = FALSE)`**：四分位距
  - Q3 - Q1
  - 对异常值稳健

##### 种群空间分布格局测量
- **方差均值比（VMR）**
  - **公式**：$VMR = \frac{\text{方差}}{\text{均值}}$
  - **生态学解释**：
    - VMR ≈ 1：随机分布
    - VMR > 1：聚集分布
    - VMR < 1：均匀分布
  - **R实现**：`vmr <- var(counts) / mean(counts)`

- **负二项分布参数k**
  - **定义**：聚集程度的度量，k值越小聚集程度越高
  - **计算方法**：通过最大似然估计或矩估计
  - **生态学意义**：k值反映物种的空间分布特性

- **Morisita分散指数**
  - **公式**：$I_\delta = n \frac{\sum x_i^2 - \sum x_i}{(\sum x_i)^2 - \sum x_i}$
  - **解释**：
    - Iδ ≈ 1：随机分布
    - Iδ > 1：聚集分布  
    - Iδ < 1：均匀分布
  - **优点**：对样本大小不敏感

- **种群分布类型判断示例**
```r
# 模拟不同分布类型的种群数据
set.seed(123)
random_dist <- rpois(50, lambda = 10)     # 随机分布（泊松分布）
clumped_dist <- rnbinom(50, size = 2, mu = 10)  # 聚集分布（负二项分布）

# 计算方差均值比
vmr_random <- var(random_dist) / mean(random_dist)
vmr_clumped <- var(clumped_dist) / mean(clumped_dist)

print(paste("随机分布 VMR:", round(vmr_random, 3)))
print(paste("聚集分布 VMR:", round(vmr_clumped, 3)))

# 分布类型判断
if (abs(vmr_random - 1) < 0.2) {
  print("随机分布：VMR ≈ 1")
} else if (vmr_random > 1.2) {
  print("聚集分布：VMR > 1")
} else if (vmr_random < 0.8) {
  print("均匀分布：VMR < 1")
}
```

#### 2. 分布形状与矩测量

##### 中心矩（Central Moments）
- **一阶中心矩**：均值（衡量中心位置）
- **二阶中心矩**：方差（衡量离散程度）
- **三阶中心矩**：偏度（衡量分布不对称性）
- **四阶中心矩**：峰度（衡量分布尖锐程度）

##### 偏度（Skewness）
- **定义**：$\gamma_1 = \frac{E[(X-\mu)^3]}{\sigma^3}$
- **生态学意义**：
  - 右偏（正偏）：多数个体较小，少数个体很大（如森林树木直径）
  - 左偏（负偏）：多数个体较大，少数个体很小
  - 对称：个体大小分布均匀
- **判断标准**：
  - |偏度| < 0.5：近似对称
  - 0.5 ≤ |偏度| < 1：中等偏度
  - |偏度| ≥ 1：高度偏斜

##### 峰度（Kurtosis）
- **定义**：$\beta_2 = \frac{E[(X-\mu)^4]}{\sigma^4}$
- **生态学意义**：
  - 尖峰（leptokurtic）：数据集中在均值附近，尾部较重
  - 平峰（platykurtic）：数据分布较均匀，尾部较轻
  - 正态分布峰度 = 3
- **超额峰度**：峰度 - 3
  - > 0：比正态分布更尖峰
  - < 0：比正态分布更平峰

##### 分位数（Quantiles）
- **定义**：将数据按大小顺序排列后的分割点
- **常用分位数**：
  - 四分位数：Q1(25%), Q2(50%), Q3(75%)
  - 十分位数：每10%一个分割点
  - 百分位数：每1%一个分割点
- **生态学应用**：
  - 识别异常值（如低于Q1-1.5IQR或高于Q3+1.5IQR）
  - 描述物种大小分布（如树木直径的90%分位数）
  - 确定保护阈值（如前10%的最大个体需要特殊保护）
  - 建立生态基准（如水质指标的第95百分位数）
  - 监测种群变化（比较不同年份的物种丰富度中位数）

##### moments包函数
- **`skewness(x)`**：偏度
  - 衡量分布的不对称性
  - > 0：右偏，< 0：左偏，= 0：对称

- **`kurtosis(x)`**：峰度
  - 衡量分布的尖锐程度
  - 正态分布的峰度为3
  - > 3：尖峰，< 3：平峰

#### 3. 群落生态统计描述

##### 物种丰富度统计
- **样方物种数**：基本描述统计（均值、方差、范围等）
- **物种累积曲线**：随样本量增加的物种发现速率
- **稀有物种处理**：对稀有物种的统计调整方法

##### 多样性指数
- **Shannon-Wiener多样性指数**
  - **公式**：$H' = -\sum_{i=1}^S p_i \ln p_i$
  - **生态学意义**：综合考虑物种丰富度和均匀度
  - **R实现**：`vegan::diversity(x, index = "shannon")`

- **Simpson多样性指数**
  - **公式**：$D = 1 - \sum_{i=1}^S p_i^2$
  - **生态学意义**：强调常见物种的优势度
  - **R实现**：`vegan::diversity(x, index = "simpson")`

##### 均匀度指数
- **Pielou均匀度指数**
  - **公式**：$J' = \frac{H'}{H'_{max}} = \frac{H'}{\ln S}$
  - **解释**：实际多样性与最大可能多样性的比值
  - **范围**：0-1，值越大均匀度越高

##### 群落统计示例
```r
# 安装并加载vegan包
# install.packages("vegan")
library(vegan)

# 模拟群落数据（5个样方，10个物种）
set.seed(456)
community_data <- matrix(rpois(50, lambda = c(rep(20, 3), rep(5, 7))), 
                        nrow = 5, ncol = 10)
colnames(community_data) <- paste("Species", 1:10)

# 基本描述统计
species_richness <- apply(community_data > 0, 1, sum)
print(paste("样方物种丰富度:", paste(species_richness, collapse = ", ")))
print(paste("平均丰富度:", round(mean(species_richness), 2)))

# 多样性计算
shannon_diversity <- diversity(community_data, index = "shannon")
simpson_diversity <- diversity(community_data, index = "simpson")

print("=== 多样性指数 ===")
print(paste("Shannon多样性:", round(shannon_diversity, 3)))
print(paste("Simpson多样性:", round(simpson_diversity, 3)))

# 均匀度计算
pielou_evenness <- shannon_diversity / log(species_richness)
print(paste("Pielou均匀度:", round(pielou_evenness, 3)))
```

#### 4. 概率分布函数在估计中的应用

##### 正态分布相关
- **`qnorm(p, mean, sd)`**：分位数函数
  - 计算置信区间的临界值
  - 常用：`qnorm(0.975)` = 1.96（95%置信区间）

- **`qt(p, df)`**：t分布分位数函数
  - 小样本置信区间
  - `df`：自由度（通常为n-1）

#### 4. 置信区间计算

##### 大样本均值置信区间
```r
# 一般形式
ci <- sample_mean + c(-1, 1) * qnorm(1-alpha/2) * se

# 计算标准误的示例
sample_data <- c(120, 125, 118, 122, 130, 115, 128, 121, 119, 123)
sample_mean <- mean(sample_data)
sample_sd <- sd(sample_data)
n <- length(sample_data)

# 标准误计算
standard_error <- sample_sd / sqrt(n)
print(paste("标准差:", round(sample_sd, 2)))
print(paste("标准误:", round(standard_error, 2)))
print(paste("样本大小:", n))
print(paste("标准误 = 标准差 / √样本大小 =", 
            round(sample_sd, 2), "/", round(sqrt(n), 2), "=", 
            round(standard_error, 2)))
```

##### 小样本均值置信区间（t分布）
```r
# t分布置信区间
ci_t <- sample_mean + c(-1, 1) * qt(1-alpha/2, df=n-1) * se
```

##### 比例的置信区间
```r
# 正态近似
se_p <- sqrt(p_hat * (1-p_hat) / n)
ci_p <- p_hat + c(-1, 1) * qnorm(1-alpha/2) * se_p
```

#### 5. 样本大小计算

##### 均值估计的样本大小
- **公式**：$n = \left(\frac{z_{\alpha/2} \cdot \sigma}{E}\right)^2$
- **参数**：
  - $z_{\alpha/2}$：临界值
  - $\sigma$：总体标准差（估计）
  - $E$：期望的误差边界

##### 比例估计的样本大小
- **公式**：$n = \frac{z_{\alpha/2}^2 \cdot p(1-p)}{E^2}$
- **最保守估计**：当p未知时，使用p = 0.5

#### 6. 生态学参数估计函数

##### 种群大小估计相关
- **`RMark`包**：标记重捕分析的完整解决方案
  - 支持多种标记重捕模型
  - 包括Lincoln-Petersen、Jolly-Seber等

- **`Distance`包**：距离抽样分析
  - 检测函数拟合和密度估计
  - 支持线transect和点样方方法

- **`unmarked`包**：占用模型和种群估计
  - 多种野生动物种群估计方法
  - 支持不完美检测的模型

##### 生物多样性估计相关
- **`vegan::rarefy()`**：物种丰富度外推
  - 计算给定样本量的期望物种数
  - 绘制rarefaction曲线

- **`vegan::estimateR()`**：丰富度估计量
  - 返回Chao1、ACE、Jackknife等估计值
  - 包含观察物种数和多种估计量

- **`vegan::diversity()`**：多样性指数计算
  - Shannon、Simpson、InvSimpson指数
  - 支持多种多样性度量

- **`SPECIES`包**：专门用于物种丰富度估计
  - 更多非参数估计方法
  - 包括Chao2、ICE等估计量

##### 生态估计示例
```r
# 使用vegan包进行多样性估计
library(vegan)

# 计算所有多样性指数
diversity_indices <- function(community_data) {
  result <- data.frame(
    Observed = apply(community_data > 0, 1, sum),
    Shannon = diversity(community_data, index = "shannon"),
    Simpson = diversity(community_data, index = "simpson"),
    InvSimpson = diversity(community_data, index = "invsimpson")
  )
  return(result)
}

# 丰富度估计
richness_estimation <- function(community_data) {
  estimates <- estimateR(community_data)
  return(t(estimates))
}

# 使用示例
set.seed(123)
sample_data <- matrix(rpois(50, lambda = 5), nrow = 5, ncol = 10)

print("多样性指数:")
print(diversity_indices(sample_data))

print("丰富度估计:")
print(richness_estimation(sample_data))
```

### 课后练习

**题目**：某湿地保护区进行鸟类多样性调查，收集了以下数据：

```r
# 40个样点的鸟类物种数
species_counts <- c(8, 12, 15, 9, 11, 14, 13, 10, 16, 12, 
                   9, 13, 11, 15, 14, 12, 10, 17, 13, 11,
                   14, 12, 16, 13, 15, 11, 14, 12, 18, 13,
                   15, 14, 12, 11, 16, 13, 14, 15, 12, 17)

# 25只鸟类的体重数据（克）
bird_weights <- c(25.3, 28.7, 32.1, 29.5, 26.8, 31.2, 27.9, 30.4, 28.2, 29.8,
                 26.5, 31.7, 28.9, 30.1, 27.4, 32.5, 29.2, 28.6, 31.0, 27.1,
                 30.7, 28.4, 29.9, 31.4, 27.8)

# 100个巢穴的繁殖成功情况（1=成功，0=失败）
breeding_success <- c(rep(1, 78), rep(0, 22))  # 78个成功，22个失败
```

请完成（使用描述统计和参数估计方法，结合概率分布知识）：

1. **描述统计分析**：
   - 计算物种数和鸟类体重的所有中心趋势和离散程度指标
   - 计算繁殖成功率及其基本统计量
   - 使用`summary()`函数获得数据概况

2. **分布特征分析**：
   - 计算鸟类体重数据的偏度和峰度
   - 绘制直方图分析数据分布形状
   - 进行正态性检验（Shapiro-Wilk检验）

3. **点估计**：
   - 估计鸟类物种数的总体均值和方差
   - 估计鸟类体重的总体均值和标准差
   - 估计总体繁殖成功率

4. **区间估计**：
   - 计算物种数总体均值的95%和99%置信区间
   - 计算鸟类体重总体均值的90%置信区间（使用t分布）
   - 计算繁殖成功率的95%置信区间

5. **样本大小规划**：
   - 如果要求物种数估计的误差边界不超过1种，需要多大样本？
   - 如果要求体重估计的误差边界不超过0.5克，需要多大样本？

6. **比较分析**：
   - 比较不同置信水平（90%, 95%, 99%）下置信区间的宽度变化
   - 分析样本大小对置信区间宽度的影响

7. **生态学解释**：
   - 解释各统计量的生态学意义
   - 讨论置信区间在保护区管理决策中的应用价值
