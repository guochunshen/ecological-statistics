
## 第3课：植物群落调查数据框

### 生态学背景
在植物群落调查中，需要同时记录多种信息：样方编号、物种名称、株高、是否存活等。这些不同类型的数据需要组织在一个表格中，这就需要用到数据框。

### 演示数据
```r
# 某山坡5个样方的植物调查数据
plot_data <- data.frame(
  plot_id = c("S001", "S002", "S003", "S004", "S005"),
  species = c("马尾松", "杉木", "樟树", "栎树", "枫香"),
  height_m = c(12.5, 8.3, 15.2, 10.7, 9.8),
  diameter_cm = c(18.2, 12.5, 22.1, 16.8, 14.3),
  alive = c(TRUE, TRUE, FALSE, TRUE, TRUE)
)
```

### 课堂演示过程
```r
# 1. 创建植物调查数据框
plot_data <- data.frame(
  plot_id = c("S001", "S002", "S003", "S004", "S005"),
  species = c("马尾松", "杉木", "樟树", "栎树", "枫香"),
  height_m = c(12.5, 8.3, 15.2, 10.7, 9.8),
  diameter_cm = c(18.2, 12.5, 22.1, 16.8, 14.3),
  alive = c(TRUE, TRUE, FALSE, TRUE, TRUE)
)

# 2. 查看数据框
plot_data
print(plot_data)

# 3. 查看数据框结构
str(plot_data)  # 显示每列的数据类型

# 4. 查看数据框维度
nrow(plot_data)  # 行数
ncol(plot_data)  # 列数
dim(plot_data)   # 行数和列数

# 5. 查看前几行和后几行
head(plot_data, 3)  # 前3行
tail(plot_data, 2)   # 后2行

# 6. 访问特定列
plot_data$species    # 物种列
plot_data$height_m   # 高度列

# 7. 计算统计量
mean(plot_data$height_m)  # 平均高度
sum(plot_data$alive)      # 存活植物数量
```

### R语言知识点详解

#### 1. 数据框（Data Frame）
- **是什么**：R中最重要的数据结构，类似于Excel表格或数据库表
- **语法**：`data.frame(列名1 = 向量1, 列名2 = 向量2, ...)`
- **核心特点**：
  - 每列可以是不同的数据类型（数值、字符、逻辑）
  - 但每列内部必须是相同类型
  - 所有列必须有相同的长度（行数）
  - 每行代表一个观察单位，每列代表一个变量
- **与矩阵的区别**：
  - 矩阵：所有元素必须是相同类型
  - 数据框：不同列可以是不同类型
- **生态学应用**：完美适合存储野外调查数据

#### 2. R中的数据类型系统
##### 数值型（Numeric/Double）
- **特点**：包含小数点的数字
- **示例**：`12.5`, `8.3`, `15.2`
- **用途**：测量值、计数、比例等

##### 字符型（Character）
- **特点**：文本数据，用引号包围
- **示例**：`"S001"`, `"马尾松"`, `"杉木"`
- **用途**：名称、标识符、分类标签

##### 逻辑型（Logical）
- **特点**：只有两个值：TRUE和FALSE
- **示例**：`TRUE`, `FALSE`
- **用途**：是/否判断、条件标记
- **运算**：可以进行数学运算（TRUE=1, FALSE=0）

#### 3. 数据框结构查看函数
##### `str()` - Structure函数
- **作用**：显示数据框的完整结构信息
- **显示内容**：
  - 数据框类型和维度
  - 每列的数据类型
  - 前几个值的预览
- **读法技巧**：
  - `'data.frame': 5 obs. of 5 variables` - 5行5列的数据框
  - `$ plot_id : chr` - plot_id列是字符型
  - `$ height_m: num` - height_m列是数值型

##### `head()` 和 `tail()`
- **语法**：`head(x, n = 6)`, `tail(x, n = 6)`
- **作用**：查看数据框的开头或结尾几行
- **参数**：n指定显示的行数，默认6行
- **应用场景**：
  - 快速了解数据格式
  - 检查数据导入是否正确
  - 大数据集的初步查看

##### 维度函数
- **`nrow()`**：返回行数（观察数量）
- **`ncol()`**：返回列数（变量数量）
- **`dim()`**：返回维度向量c(行数, 列数)
- **`names()` 或 `colnames()`**：返回列名

#### 4. 数据框列访问
##### 美元符号 `$` 操作符
- **语法**：`数据框名$列名`
- **特点**：
  - 返回该列的向量
  - 支持名称自动补全（在RStudio中）
  - 最常用的列访问方式
- **注意**：列名不需要引号

##### 双括号 `[[]]` 操作符
- **语法**：`数据框名[["列名"]]` 或 `数据框名[[列位置]]`
- **与$的区别**：
  - 支持变量名作为列名：`df[[var_name]]`
  - 可以使用数字索引：`df[[1]]`

##### 单括号 `[]` 操作符
- **语法**：`数据框名[行, 列]`
- **特点**：返回数据框（保持原结构）
- **示例**：`plot_data[, "species"]` - 选择species列但保持数据框格式

### 课后练习
**题目**：某河流生态调查数据：
```r
river_survey <- data.frame(
  site_id = c("R01", "R02", "R03", "R04"),
  fish_species = c("草鱼", "鲤鱼", "鲫鱼", "青鱼"),
  length_cm = c(25.3, 18.7, 12.4, 31.2),
  weight_g = c(680, 420, 180, 1200),
  mature = c(TRUE, FALSE, FALSE, TRUE)
)
```

请完成（使用数据框操作、向量计算等已学内容）：
1. 创建数据框并显示整个数据框
2. 使用str()函数查看数据框的结构
3. 计算鱼类的平均长度和平均重量（使用mean()和$操作符）
4. 统计有多少条成熟的鱼（使用sum()和逻辑值运算）
5. 显示所有鱼类的名称（使用$操作符）
6. 计算最大和最小的鱼重量（使用max()和min()函数）
7. 创建一个包含调查总结的字符串（使用paste()函数）
