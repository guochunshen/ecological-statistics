
## 第13课：描述统计与参数估计

### 统计学背景
描述统计是统计学的基础，帮助我们总结和描述数据的基本特征。参数估计则是统计推断的核心，通过样本数据估计总体参数。在生态学研究中，我们通常只能观察到总体的一部分（样本），需要通过样本来推断总体的特征，如某物种的平均体重、种群密度的置信区间等。

### 演示数据
```r
# 某保护区植物群落调查数据
set.seed(123)
plant_height <- rnorm(50, mean = 120, sd = 25)      # 植物高度(cm)
species_count <- rpois(40, lambda = 15)             # 样方物种数
cover_percentage <- rbeta(35, 2, 3) * 100           # 植被覆盖度(%)
survival_rate <- rbinom(60, 1, 0.85)                # 植物存活情况
```

### 课堂演示过程

#### 1. 描述统计基础

##### 中心趋势测量
```r
# 创建植物高度数据
set.seed(123)
plant_heights <- rnorm(50, mean = 120, sd = 25)

# 1. 算术平均数（均值）
mean_height <- mean(plant_heights)
print(paste("平均高度:", round(mean_height, 2), "cm"))

# 2. 中位数
median_height <- median(plant_heights)
print(paste("中位数高度:", round(median_height, 2), "cm"))

# 3. 众数（自定义函数）
calculate_mode <- function(x) {
  # 对于连续数据，找最频繁出现的近似值
  density_result <- density(x)
  mode_value <- density_result$x[which.max(density_result$y)]
  return(mode_value)
}
mode_height <- calculate_mode(plant_heights)
print(paste("近似众数:", round(mode_height, 2), "cm"))

# 比较三种中心趋势测量
print("=== 中心趋势比较 ===")
print(paste("均值:", round(mean_height, 2)))
print(paste("中位数:", round(median_height, 2)))
print(paste("众数:", round(mode_height, 2)))
```

##### 离散程度测量
```r
# 1. 极差
range_height <- max(plant_heights) - min(plant_heights)
print(paste("极差:", round(range_height, 2), "cm"))

# 2. 四分位距
q1 <- quantile(plant_heights, 0.25)
q3 <- quantile(plant_heights, 0.75)
iqr_height <- q3 - q1
print(paste("四分位距:", round(iqr_height, 2), "cm"))

# 3. 方差
var_height <- var(plant_heights)
print(paste("方差:", round(var_height, 2), "cm²"))

# 4. 标准差
sd_height <- sd(plant_heights)
print(paste("标准差:", round(sd_height, 2), "cm"))

# 5. 变异系数
cv_height <- sd_height / mean_height * 100
print(paste("变异系数:", round(cv_height, 2), "%"))

# 五数概括
summary_stats <- summary(plant_heights)
print("五数概括:")
print(summary_stats)
```

##### 分布形状测量
```r
# 安装并加载moments包（如果没有的话）
# install.packages("moments")
library(moments)

# 1. 偏度（Skewness）
skewness_value <- skewness(plant_heights)
print(paste("偏度:", round(skewness_value, 3)))

# 解释偏度
if (skewness_value > 0.5) {
  skew_interpretation <- "右偏（正偏）"
} else if (skewness_value < -0.5) {
  skew_interpretation <- "左偏（负偏）"
} else {
  skew_interpretation <- "近似对称"
}
print(paste("分布形状:", skew_interpretation))

# 2. 峰度（Kurtosis）
kurtosis_value <- kurtosis(plant_heights)
print(paste("峰度:", round(kurtosis_value, 3)))

# 解释峰度（与正态分布比较）
if (kurtosis_value > 3.5) {
  kurt_interpretation <- "尖峰分布"
} else if (kurtosis_value < 2.5) {
  kurt_interpretation <- "平峰分布"
} else {
  kurt_interpretation <- "近似正态分布峰度"
}
print(paste("峰度特征:", kurt_interpretation))
```

#### 2. 样本与总体的关系

```r
# 演示抽样分布的概念
set.seed(456)

# 假设总体：某森林所有树木的高度服从N(150, 30²)
population_mean <- 150
population_sd <- 30

# 从总体中抽取不同大小的样本
sample_sizes <- c(5, 10, 30, 100)
n_simulations <- 1000

# 存储不同样本大小的样本均值
sampling_distribution <- list()

for (i in 1:length(sample_sizes)) {
  n <- sample_sizes[i]
  sample_means <- numeric(n_simulations)
  
  for (j in 1:n_simulations) {
    sample_data <- rnorm(n, mean = population_mean, sd = population_sd)
    sample_means[j] <- mean(sample_data)
  }
  
  sampling_distribution[[i]] <- sample_means
  
  print(paste("样本大小:", n))
  print(paste("样本均值的均值:", round(mean(sample_means), 2)))
  print(paste("样本均值的标准差:", round(sd(sample_means), 2)))
  print(paste("理论标准误:", round(population_sd/sqrt(n), 2)))
  print("---")
}

# 可视化抽样分布
par(mfrow = c(2, 2))
for (i in 1:length(sample_sizes)) {
  hist(sampling_distribution[[i]], 
       main = paste("n =", sample_sizes[i]), 
       xlab = "样本均值",
       col = "lightblue",
       breaks = 30)
  abline(v = population_mean, col = "red", lwd = 2)
}
par(mfrow = c(1, 1))
```

#### 3. 点估计

```r
# 点估计：用样本统计量估计总体参数

# 生成一个样本
set.seed(789)
sample_data <- rnorm(30, mean = 120, sd = 20)

# 1. 均值的点估计
sample_mean <- mean(sample_data)
print(paste("样本均值（总体均值的点估计）:", round(sample_mean, 2)))

# 2. 方差的点估计
sample_var <- var(sample_data)  # 无偏估计（分母为n-1）
print(paste("样本方差（总体方差的点估计）:", round(sample_var, 2)))

# 3. 标准差的点估计
sample_sd <- sd(sample_data)
print(paste("样本标准差（总体标准差的点估计）:", round(sample_sd, 2)))

# 4. 比例的点估计（对于二分类数据）
# 例子：植物存活情况
survival_data <- rbinom(50, 1, 0.8)
survival_proportion <- mean(survival_data)
print(paste("存活比例的点估计:", round(survival_proportion, 3)))

# 点估计的性质
# 1. 无偏性演示
true_mean <- 100
n_samples <- 1000
sample_means <- numeric(n_samples)

for (i in 1:n_samples) {
  sample_i <- rnorm(20, mean = true_mean, sd = 15)
  sample_means[i] <- mean(sample_i)
}

bias <- mean(sample_means) - true_mean
print(paste("估计偏差:", round(bias, 4)))
print("样本均值是总体均值的无偏估计")
```

#### 4. 区间估计（置信区间）

```r
# 置信区间：给出参数的可能取值范围

# 1. 均值的置信区间（已知总体方差或大样本）
set.seed(321)
sample_heights <- rnorm(50, mean = 150, sd = 25)

n <- length(sample_heights)
sample_mean <- mean(sample_heights)
sample_sd <- sd(sample_heights)

# 95%置信区间
confidence_level <- 0.95
alpha <- 1 - confidence_level
z_score <- qnorm(1 - alpha/2)  # 双侧检验

# 标准误
standard_error <- sample_sd / sqrt(n)

# 置信区间
margin_error <- z_score * standard_error
ci_lower <- sample_mean - margin_error
ci_upper <- sample_mean + margin_error

print(paste("样本均值:", round(sample_mean, 2)))
print(paste("95%置信区间: [", round(ci_lower, 2), ", ", round(ci_upper, 2), "]"))

# 解释置信区间
print("解释：我们有95%的信心认为总体均值在此区间内")

# 2. t分布置信区间（小样本，总体方差未知）
small_sample <- sample_heights[1:15]  # 小样本
n_small <- length(small_sample)
mean_small <- mean(small_sample)
sd_small <- sd(small_sample)

# t分布临界值
t_critical <- qt(1 - alpha/2, df = n_small - 1)
se_small <- sd_small / sqrt(n_small)
margin_t <- t_critical * se_small

ci_t_lower <- mean_small - margin_t
ci_t_upper <- mean_small + margin_t

print("=== 小样本t分布置信区间 ===")
print(paste("样本大小:", n_small))
print(paste("95%置信区间: [", round(ci_t_lower, 2), ", ", round(ci_t_upper, 2), "]"))

# 3. 比例的置信区间
# 例子：种子萌发率
germinated <- 42  # 萌发的种子数
total_seeds <- 50  # 总种子数
p_hat <- germinated / total_seeds

# 正态近似（大样本）
se_p <- sqrt(p_hat * (1 - p_hat) / total_seeds)
margin_p <- z_score * se_p
ci_p_lower <- p_hat - margin_p
ci_p_upper <- p_hat + margin_p

print("=== 比例的置信区间 ===")
print(paste("样本比例:", round(p_hat, 3)))
print(paste("95%置信区间: [", round(ci_p_lower, 3), ", ", round(ci_p_upper, 3), "]"))

# 4. 不同置信水平的比较
confidence_levels <- c(0.90, 0.95, 0.99)
print("=== 不同置信水平的置信区间 ===")

for (conf_level in confidence_levels) {
  alpha_i <- 1 - conf_level
  z_i <- qnorm(1 - alpha_i/2)
  margin_i <- z_i * standard_error
  ci_lower_i <- sample_mean - margin_i
  ci_upper_i <- sample_mean + margin_i
  
  print(paste(conf_level*100, "%置信区间: [", 
              round(ci_lower_i, 2), ", ", round(ci_upper_i, 2), "]"))
}
```

#### 5. 估计精度与样本大小

```r
# 样本大小对估计精度的影响

# 1. 给定精度要求，计算所需样本大小
desired_margin <- 5      # 期望的误差边界
population_sd_est <- 25  # 总体标准差的估计
confidence_level <- 0.95
z_score <- qnorm(1 - (1-confidence_level)/2)

required_n <- (z_score * population_sd_est / desired_margin)^2
print(paste("要求误差边界不超过", desired_margin, 
            "cm，需要样本大小：", ceiling(required_n)))

# 2. 不同样本大小的置信区间宽度比较
sample_sizes <- c(10, 20, 50, 100, 200)
ci_widths <- numeric(length(sample_sizes))

for (i in 1:length(sample_sizes)) {
  n <- sample_sizes[i]
  se <- population_sd_est / sqrt(n)
  margin <- z_score * se
  ci_widths[i] <- 2 * margin  # 置信区间宽度
}

# 可视化置信区间宽度与样本大小的关系
plot(sample_sizes, ci_widths, 
     type = "b", 
     main = "置信区间宽度 vs 样本大小",
     xlab = "样本大小", 
     ylab = "95%置信区间宽度",
     col = "blue",
     pch = 19)
grid()

print("=== 样本大小与置信区间宽度 ===")
for (i in 1:length(sample_sizes)) {
  print(paste("n =", sample_sizes[i], 
              ", 置信区间宽度:", round(ci_widths[i], 2)))
}
```

### R语言知识点详解

#### 1. 描述统计函数系统

##### 中心趋势测量
- **`mean(x, na.rm = FALSE)`**：算术平均数
  - 适用于数值型数据
  - `na.rm = TRUE`可忽略缺失值
  - 受极值影响较大

- **`median(x, na.rm = FALSE)`**：中位数
  - 对极值稳健
  - 适用于偏态分布
  - 50%分位数

- **`mode()`**：R没有内置mode函数，需自定义
  - 对于离散数据：最频繁出现的值
  - 对于连续数据：使用密度估计

##### 离散程度测量
- **`var(x, na.rm = FALSE)`**：样本方差
  - 分母为n-1（无偏估计）
  - 单位为原变量单位的平方

- **`sd(x, na.rm = FALSE)`**：样本标准差
  - 方差的平方根
  - 与原变量同单位

- **`range(x, na.rm = FALSE)`**：值域
  - 返回c(min, max)
  - 计算极差：`diff(range(x))`

- **`quantile(x, probs)`**：分位数
  - `probs`：要计算的分位数（0-1之间）
  - 常用：`quantile(x, c(0.25, 0.5, 0.75))`

- **`IQR(x, na.rm = FALSE)`**：四分位距
  - Q3 - Q1
  - 对异常值稳健

#### 2. 分布形状测量

##### moments包函数
- **`skewness(x)`**：偏度
  - 衡量分布的不对称性
  - > 0：右偏，< 0：左偏，= 0：对称

- **`kurtosis(x)`**：峰度
  - 衡量分布的尖锐程度
  - 正态分布的峰度为3
  - > 3：尖峰，< 3：平峰

#### 3. 概率分布函数在估计中的应用

##### 正态分布相关
- **`qnorm(p, mean, sd)`**：分位数函数
  - 计算置信区间的临界值
  - 常用：`qnorm(0.975)` = 1.96（95%置信区间）

- **`qt(p, df)`**：t分布分位数函数
  - 小样本置信区间
  - `df`：自由度（通常为n-1）

#### 4. 置信区间计算

##### 大样本均值置信区间
```r
# 一般形式
ci <- sample_mean + c(-1, 1) * qnorm(1-alpha/2) * se
```

##### 小样本均值置信区间（t分布）
```r
# t分布置信区间
ci_t <- sample_mean + c(-1, 1) * qt(1-alpha/2, df=n-1) * se
```

##### 比例的置信区间
```r
# 正态近似
se_p <- sqrt(p_hat * (1-p_hat) / n)
ci_p <- p_hat + c(-1, 1) * qnorm(1-alpha/2) * se_p
```

#### 5. 样本大小计算

##### 均值估计的样本大小
- **公式**：$n = \left(\frac{z_{\alpha/2} \cdot \sigma}{E}\right)^2$
- **参数**：
  - $z_{\alpha/2}$：临界值
  - $\sigma$：总体标准差（估计）
  - $E$：期望的误差边界

##### 比例估计的样本大小
- **公式**：$n = \frac{z_{\alpha/2}^2 \cdot p(1-p)}{E^2}$
- **最保守估计**：当p未知时，使用p = 0.5

### 课后练习

**题目**：某湿地保护区进行鸟类多样性调查，收集了以下数据：

```r
# 40个样点的鸟类物种数
species_counts <- c(8, 12, 15, 9, 11, 14, 13, 10, 16, 12, 
                   9, 13, 11, 15, 14, 12, 10, 17, 13, 11,
                   14, 12, 16, 13, 15, 11, 14, 12, 18, 13,
                   15, 14, 12, 11, 16, 13, 14, 15, 12, 17)

# 25只鸟类的体重数据（克）
bird_weights <- c(25.3, 28.7, 32.1, 29.5, 26.8, 31.2, 27.9, 30.4, 28.2, 29.8,
                 26.5, 31.7, 28.9, 30.1, 27.4, 32.5, 29.2, 28.6, 31.0, 27.1,
                 30.7, 28.4, 29.9, 31.4, 27.8)

# 100个巢穴的繁殖成功情况（1=成功，0=失败）
breeding_success <- c(rep(1, 78), rep(0, 22))  # 78个成功，22个失败
```

请完成（使用描述统计和参数估计方法，结合概率分布知识）：

1. **描述统计分析**：
   - 计算物种数和鸟类体重的所有中心趋势和离散程度指标
   - 计算繁殖成功率及其基本统计量
   - 使用`summary()`函数获得数据概况

2. **分布特征分析**：
   - 计算鸟类体重数据的偏度和峰度
   - 绘制直方图分析数据分布形状
   - 进行正态性检验（Shapiro-Wilk检验）

3. **点估计**：
   - 估计鸟类物种数的总体均值和方差
   - 估计鸟类体重的总体均值和标准差
   - 估计总体繁殖成功率

4. **区间估计**：
   - 计算物种数总体均值的95%和99%置信区间
   - 计算鸟类体重总体均值的90%置信区间（使用t分布）
   - 计算繁殖成功率的95%置信区间

5. **样本大小规划**：
   - 如果要求物种数估计的误差边界不超过1种，需要多大样本？
   - 如果要求体重估计的误差边界不超过0.5克，需要多大样本？

6. **比较分析**：
   - 比较不同置信水平（90%, 95%, 99%）下置信区间的宽度变化
   - 分析样本大小对置信区间宽度的影响

7. **生态学解释**：
   - 解释各统计量的生态学意义
   - 讨论置信区间在保护区管理决策中的应用价值
