
## 第7课：森林类型多样性比较

### 生态学背景
不同森林类型的物种多样性存在显著差异。通过比较松林、栎林、混交林的物种数量，我们可以了解森林结构对生物多样性的影响。这需要用到描述性统计和基础可视化。

### 演示数据
```r
# 三种森林类型各5个样地的物种数量
pine_forest <- c(22, 25, 20, 28, 24)      # 松林
oak_forest <- c(35, 32, 38, 30, 34)       # 栎林  
mixed_forest <- c(45, 42, 48, 40, 46)     # 混交林
```

### 课堂演示过程
```r
# 1. 创建三种森林类型数据
pine_forest <- c(22, 25, 20, 28, 24)
oak_forest <- c(35, 32, 38, 30, 34)  
mixed_forest <- c(45, 42, 48, 40, 46)

# 2. 计算描述性统计
# 平均值
pine_mean <- mean(pine_forest)
oak_mean <- mean(oak_forest)
mixed_mean <- mean(mixed_forest)

# 标准差
pine_sd <- sd(pine_forest)
oak_sd <- sd(oak_forest)
mixed_sd <- sd(mixed_forest)

# 最大值和最小值
range(pine_forest)
range(oak_forest)
range(mixed_forest)

# 3. 创建汇总表
forest_summary <- data.frame(
  森林类型 = c("松林", "栎林", "混交林"),
  平均物种数 = c(pine_mean, oak_mean, mixed_mean),
  标准差 = c(pine_sd, oak_sd, mixed_sd),
  最大值 = c(max(pine_forest), max(oak_forest), max(mixed_forest)),
  最小值 = c(min(pine_forest), min(oak_forest), min(mixed_forest))
)
print(forest_summary)

# 4. 箱线图比较
boxplot(pine_forest, oak_forest, mixed_forest,
        names = c("松林", "栎林", "混交林"),
        ylab = "物种数量", 
        main = "不同森林类型物种多样性比较",
        col = c("lightgreen", "lightblue", "lightyellow"))

# 5. 添加平均值点
points(1:3, c(pine_mean, oak_mean, mixed_mean), 
       col = "red", pch = 19, cex = 1.5)

# 6. 条形图显示平均值
barplot(c(pine_mean, oak_mean, mixed_mean),
        names.arg = c("松林", "栎林", "混交林"),
        ylab = "平均物种数",
        main = "各森林类型平均物种数量",
        col = c("lightgreen", "lightblue", "lightyellow"))

# 7. 方差分析(简单介绍)
all_data <- c(pine_forest, oak_forest, mixed_forest)
forest_type <- rep(c("松林", "栎林", "混交林"), each = 5)
forest_df <- data.frame(species_count = all_data, type = forest_type)
```

### R语言知识点详解

#### 1. 描述性统计函数深入解析
##### `sd()` - 标准差函数
- **作用**：计算样本标准差，衡量数据的离散程度
- **语法**：`sd(x, na.rm = FALSE)`
- **数学含义**：
  - 标准差越大，数据越分散
  - 标准差越小，数据越集中在均值附近
  - 单位与原数据相同
- **与方差的关系**：标准差 = √方差
- **相关函数**：
  - `var()`：计算方差
  - `mad()`：计算中位数绝对偏差（对异常值更稳健）

##### `range()` - 值域函数
- **作用**：返回最小值和最大值组成的向量
- **语法**：`range(x, na.rm = FALSE)`
- **返回值**：长度为2的数值向量 c(min, max)
- **应用**：
  - 快速了解数据的取值范围
  - 检查数据是否在合理范围内
  - 设置图形的坐标轴范围

#### 2. R基础绘图系统详解
##### `boxplot()` - 箱线图函数
- **作用**：绘制箱线图，显示数据的分布特征
- **语法**：`boxplot(..., names, main, xlab, ylab, col)`
- **箱线图解读**：
  - 盒子：第一四分位数(Q1)到第三四分位数(Q3)，包含50%的数据
  - 中线：中位数(Q2)
  - 须线：延伸到1.5倍四分位数间距的范围
  - 点：超出须线的异常值
- **参数详解**：
  - `names`：各组的标签
  - `main`：图形标题
  - `xlab`, `ylab`：x轴和y轴标签
  - `col`：填充颜色
  - `border`：边框颜色
  - `notch`：是否显示置信区间缺口

##### `barplot()` - 条形图函数
- **作用**：绘制条形图，比较不同组的数值
- **语法**：`barplot(height, names.arg, main, xlab, ylab, col)`
- **参数详解**：
  - `height`：条形的高度值
  - `names.arg`：条形的标签
  - `beside`：并排显示多组数据时设为TRUE
  - `horiz`：是否绘制水平条形图
- **应用场景**：
  - 比较不同组的均值
  - 显示分类数据的频数
  - 展示比例或百分比

#### 3. 图形参数和美化
##### 颜色参数 `col`
- **预定义颜色**：`"red"`, `"blue"`, `"green"` 等
- **颜色名称**：`colors()` 查看所有可用颜色名称
- **十六进制**：`"#FF0000"` (红色)
- **RGB函数**：`rgb(1, 0, 0)` (红色)
- **颜色向量**：为不同元素指定不同颜色

##### 点的形状参数 `pch`
- **常用形状**：
  - `pch = 1`：空心圆 ○
  - `pch = 19`：实心圆 ●
  - `pch = 2`：空心三角形 △
  - `pch = 17`：实心三角形 ▲
  - `pch = 15`：实心方形 ■
- **字符形状**：`pch = "A"` 使用字符A作为点

##### 大小参数 `cex`
- **作用**：控制图形元素的大小
- **默认值**：1.0
- **用法**：
  - `cex = 1.5`：放大1.5倍
  - `cex = 0.8`：缩小为0.8倍
- **相关参数**：
  - `cex.main`：标题大小
  - `cex.lab`：轴标签大小
  - `cex.axis`：轴数字大小

#### 4. 图形叠加和增强
##### `points()` - 添加点
- **作用**：在现有图形上添加点
- **语法**：`points(x, y, col, pch, cex)`
- **坐标系统**：使用与原图相同的坐标系统
- **应用**：在箱线图上标记均值、在散点图上突出特定点

##### 图形叠加的原理
- **图层概念**：R绘图采用图层叠加的方式
- **顺序重要**：后绘制的元素会覆盖先绘制的元素
- **坐标统一**：所有叠加元素必须使用相同的坐标系统

#### 5. 数据重组和整理
##### `rep()` - 重复函数
- **作用**：重复向量元素
- **语法**：`rep(x, times, each, length.out)`
- **参数说明**：
  - `times`：整个向量重复的次数
  - `each`：每个元素重复的次数
  - `length.out`：输出向量的长度
- **示例**：
  ```r
  rep(c("A", "B"), times = 2)    # "A" "B" "A" "B"
  rep(c("A", "B"), each = 2)     # "A" "A" "B" "B"
  rep(c("A", "B"), length.out = 5) # "A" "B" "A" "B" "A"
  ```

#### 6. 图形设计最佳实践
##### 色彩选择原则
- **对比度**：确保不同组别容易区分
- **色盲友好**：避免仅依赖红绿色区分
- **一致性**：同一类型数据使用相同色系
- **专业性**：避免过于鲜艳的颜色

##### 标签和标题
- **信息完整**：包含变量名称和单位
- **简洁明了**：避免过长的标题
- **中文支持**：确保中文字符正确显示

##### 图形尺寸和比例
- **合适的比例**：避免图形过于压缩或拉伸
- **合理的尺寸**：适合展示媒介的大小
- **留白空间**：给图形元素足够的空间

### 课后练习
**题目**：某保护区三种植被类型的蝴蝶物种数调查：
```r
shrubland <- c(12, 15, 10, 14, 13)    # 灌丛
meadow <- c(18, 22, 20, 19, 21)       # 草甸
riparian <- c(25, 28, 23, 27, 26)     # 河岸林
```

请完成（使用描述统计、基础绘图等已学内容）：
1. 计算三种植被类型的平均物种数和标准差（使用mean()和sd()函数）
2. 创建一个汇总表显示基本统计信息（使用data.frame()）
3. 绘制箱线图比较三种植被类型（使用boxplot()函数）
4. 绘制条形图显示平均物种数（使用barplot()函数）
5. 在箱线图上添加平均值点（使用points()函数）
6. 判断哪种植被类型的蝴蝶多样性最高（使用which.max()和max()函数）
7. 计算每种植被类型的变异系数（标准差/平均值×100）
