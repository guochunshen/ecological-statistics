
## 第8课：动物栖息地选择分析

### 生态学背景
动物的栖息地选择与环境因子密切相关。通过分析鸟类密度与植被覆盖度的关系，我们可以了解环境因子如何影响动物分布，这是生态学研究的核心问题之一。

### 演示数据
```r
# 10个样点的植被覆盖度和鸟类密度数据
vegetation_cover <- c(20, 35, 50, 65, 80, 45, 30, 75, 60, 40)  # 植被覆盖度(%)
bird_density <- c(5, 8, 12, 18, 22, 10, 6, 20, 15, 9)          # 鸟类密度(只/公顷)
```

### 课堂演示过程
```r
# 1. 创建栖息地数据
vegetation_cover <- c(20, 35, 50, 65, 80, 45, 30, 75, 60, 40)
bird_density <- c(5, 8, 12, 18, 22, 10, 6, 20, 15, 9)

# 2. 创建数据框
habitat_data <- data.frame(
  vegetation = vegetation_cover,
  birds = bird_density
)
print(habitat_data)

# 3. 基本统计描述
summary(habitat_data)
cor(vegetation_cover, bird_density)  # 相关系数

# 4. 散点图分析
plot(vegetation_cover, bird_density,
     xlab = "植被覆盖度(%)", 
     ylab = "鸟类密度(只/公顷)",
     main = "鸟类密度与植被覆盖度关系",
     pch = 19,  # 实心圆点
     col = "blue",
     cex = 1.2)  # 点的大小

# 5. 线性回归分析
bird_model <- lm(bird_density ~ vegetation_cover)
summary(bird_model)  # 回归结果

# 6. 添加回归线
abline(bird_model, col = "red", lwd = 2)

# 7. 添加回归方程到图上
# 获取回归系数
intercept <- round(coef(bird_model)[1], 2)
slope <- round(coef(bird_model)[2], 2)
r_squared <- round(summary(bird_model)$r.squared, 3)

# 添加文本
text(25, 20, paste("y =", slope, "x +", intercept), pos = 4)
text(25, 18, paste("R² =", r_squared), pos = 4)

# 8. 预测分析
# 预测植被覆盖度为55%时的鸟类密度
new_vegetation <- data.frame(vegetation_cover = 55)
predicted_density <- predict(bird_model, new_vegetation)
print(paste("植被覆盖度55%时，预测鸟类密度为:", round(predicted_density, 1), "只/公顷"))

# 9. 残差分析(简单介绍)
residuals <- residuals(bird_model)
plot(fitted(bird_model), residuals,
     xlab = "拟合值", ylab = "残差",
     main = "残差图")
abline(h = 0, col = "red", lty = 2)
```

### R语言知识点详解

#### 1. 相关分析详解
##### `cor()` - 相关系数函数
- **作用**：计算两个变量之间的线性相关程度
- **语法**：`cor(x, y, method = "pearson", use = "everything")`
- **相关系数解读**：
  - **取值范围**：-1 到 +1
  - **+1**：完全正相关，一个变量增加，另一个也增加
  - **-1**：完全负相关，一个变量增加，另一个减少
  - **0**：无线性相关关系
  - **经验判断**：
    - |r| > 0.8：强相关
    - 0.5 < |r| < 0.8：中等相关
    - 0.3 < |r| < 0.5：弱相关
    - |r| < 0.3：很弱或无相关
- **相关方法**：
  - `"pearson"`：皮尔逊相关（默认），适用于线性关系
  - `"spearman"`：斯皮尔曼等级相关，适用于单调关系
  - `"kendall"`：肯德尔相关，对异常值稳健
- **缺失值处理**：
  - `use = "everything"`：有缺失值时返回NA
  - `use = "complete.obs"`：使用完整观察值对
  - `use = "pairwise.complete.obs"`：成对完整观察值

#### 2. 散点图详解
##### `plot()` - 基础绘图函数
- **作用**：绘制散点图，显示两个连续变量之间的关系
- **语法**：`plot(x, y, type, main, xlab, ylab, col, pch, cex)`
- **参数详细解释**：
  - `type`：图形类型
    - `"p"`：点图（默认）
    - `"l"`：线图
    - `"b"`：点线图
    - `"h"`：垂直线图
  - `xlim`, `ylim`：坐标轴范围，如`xlim = c(0, 100)`
  - `las`：轴标签方向（0-3）
  - `bty`：图框类型（"o", "l", "7", "c", "u", "]", "n"）

##### 散点图的解读技巧
- **趋势识别**：观察点的总体分布趋势
- **异常值发现**：远离主要分布的点
- **关系强度**：点的分散程度反映相关强度
- **非线性关系**：曲线或其他模式的识别

#### 3. 线性回归分析
##### `lm()` - 线性模型函数
- **作用**：拟合线性回归模型
- **语法**：`lm(formula, data)`
- **公式语法**：
  - `y ~ x`：y对x的简单线性回归
  - `y ~ x1 + x2`：多元线性回归
  - `y ~ x + I(x^2)`：多项式回归
  - `y ~ x1 * x2`：包含交互项的回归
- **返回对象**：lm对象，包含模型的所有信息

##### 回归结果解读
- **`summary(model)`** 的输出解读：
  - **Residuals**：残差的五数摘要
  - **Coefficients**：回归系数表
    - `Estimate`：回归系数估计值
    - `Std. Error`：标准误
    - `t value`：t统计量
    - `Pr(>|t|)`：p值，显著性水平
  - **R-squared**：决定系数，解释变异的比例
  - **F-statistic**：F检验统计量
  - **p-value**：模型整体显著性

##### `coef()` - 系数提取函数
- **作用**：提取回归模型的系数
- **语法**：`coef(model)`
- **返回值**：命名数值向量
- **应用**：构建回归方程、进行预测计算

#### 4. 回归线和图形增强
##### `abline()` - 添加直线函数
- **作用**：在现有图形上添加直线
- **语法**：`abline(a, b, h, v, reg, coef, col, lty, lwd)`
- **参数说明**：
  - `a, b`：截距和斜率
  - `h`：水平线的y坐标
  - `v`：垂直线的x坐标
  - `reg`：回归对象，自动绘制回归线
  - `coef`：系数向量c(截距, 斜率)
  - `lty`：线型（1实线, 2虚线, 3点线等）
  - `lwd`：线宽

##### `text()` - 添加文本函数
- **作用**：在图形上添加文本注释
- **语法**：`text(x, y, labels, pos, cex, col, font)`
- **参数详解**：
  - `x, y`：文本位置坐标
  - `labels`：要显示的文本
  - `pos`：相对位置（1下, 2左, 3上, 4右）
  - `offset`：文本偏移距离
  - `adj`：文本对齐方式（0左对齐, 0.5居中, 1右对齐）
  - `srt`：文本旋转角度

#### 5. 模型预测和评估
##### `predict()` - 预测函数
- **作用**：使用拟合的模型进行预测
- **语法**：`predict(object, newdata, interval, level)`
- **参数说明**：
  - `object`：拟合的模型对象
  - `newdata`：新数据，必须包含所有预测变量
  - `interval`：预测区间类型
    - `"none"`：仅点预测
    - `"confidence"`：置信区间
    - `"prediction"`：预测区间
  - `level`：置信水平，默认0.95
- **应用场景**：
  - 根据自变量预测因变量
  - 评估模型的预测能力
  - 进行决策支持

##### 残差分析
- **`residuals()` 或 `resid()`**：提取残差
- **`fitted()` 或 `fitted.values()`**：提取拟合值
- **残差图的意义**：
  - **随机分布**：模型假设得到满足
  - **系统性模式**：可能存在非线性关系或其他问题
  - **异常值**：需要特别关注的观察值
  - **方差齐性**：残差的变异性应该相对恒定

#### 6. 统计建模最佳实践
##### 模型诊断步骤
1. **散点图检查**：观察变量关系的基本形态
2. **相关性分析**：量化线性关系强度
3. **模型拟合**：建立回归模型
4. **系数解释**：理解参数的实际意义
5. **模型评估**：检查R²、F检验等
6. **残差诊断**：验证模型假设
7. **预测应用**：使用模型进行预测

##### 结果报告要素
- **样本大小**：n = 10
- **相关系数**：r = 0.85, p < 0.05
- **回归方程**：y = 0.21x - 1.25
- **决定系数**：R² = 0.72
- **显著性**：F(1,8) = 20.6, p < 0.01
- **生态学解释**：植被覆盖度解释了72%的鸟类密度变异

### 课后练习
**题目**：某湿地研究中测量了水深与水鸟数量的关系：
```r
water_depth <- c(10, 25, 40, 55, 70, 35, 20, 60, 45, 30)  # 水深(cm)
waterbird_count <- c(3, 7, 12, 15, 18, 9, 5, 16, 11, 8)   # 水鸟数量(只)
```

请完成（使用相关分析、回归分析、基础绘图等已学内容）：
1. 计算水深与水鸟数量的相关系数（使用cor()函数）
2. 绘制散点图，设置合适的坐标轴标签和标题（使用plot()函数）
3. 建立线性回归模型（使用lm()函数）
4. 在散点图上添加回归线（使用abline()函数）
5. 在图上标注回归方程和R²值（使用text()和paste()函数）
6. 预测水深为50cm时的水鸟数量（使用predict()函数）
7. 解释相关系数和回归结果的生态学意义（文字描述）
8. 检查回归模型的残差分布（使用residuals()和plot()函数）
